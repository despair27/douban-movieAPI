"use strict";angular.module("movieApp",["ui.router"]).config(["$stateProvider","$urlRouterProvider",function(e,o){o.otherwise("home"),e.state({name:"top250",url:"/{url}/{page}",parent:"home",templateUrl:"module/movie-list/movie-list.html"}).state({name:"in_theaters",url:"/{url}/{page}",parent:"home",templateUrl:"module/movie-list/movie-list.html"}).state({name:"coming_soon",url:"/{url}/{page}",parent:"home",templateUrl:"module/movie-list/movie-list.html"}).state({name:"search",url:"/{url}/{q}/{page}",parent:"home",templateUrl:"module/movie-list/movie-list.html"}).state({name:"movie-detail",url:"/movie-detail/{id}",parent:"home",templateUrl:"module/movie-detail/movie-detail.html",controller:"movieDetail"}).state({name:"america-movie",url:"/america-movie",parent:"home",templateUrl:"module/america-movie/america-movie.html"}).state({name:"home",url:"/home",templateUrl:"module/home/home.html"})}]).constant("movieConfig",{movieli:3,jsonhttp:"http://api.douban.com/v2/movie/",moviede:"http://api.douban.com/v2/movie/subject/",pagenum:5}).service("jsonpServe",["$document","$window",function(e,o){this.jsonp=function(t,i,a){var m="my_jsonp_"+Math.random().toString().replace(".",""),l=t.indexOf("?")==-1?"?":"&";o[m]=a;for(var r in i)l+=r+"="+i[r]+"&";l+="callback="+m;var n=e[0].createElement("script");n.type="text/javaScript",n.src=t+l,e[0].body.appendChild(n)}}]).directive("loading",[function(){return{restrict:"AE",replace:!0,templateUrl:"template/loading.html"}}]),angular.module("movieApp").controller("americaMovie",["$scope","jsonpServe",function(e,o){e.loading=!0,o.jsonp("http://api.douban.com/v2/movie/us_box",{},function(o){e.loading=!1,e.americaMovie=o.subjects,e.americaMovieTitle=o.title,e.$apply()})}]),angular.module("movieApp").controller("home",["$scope","$location",function(e,o){e.location=o,e.$watch("location.path()",function(o){o.indexOf("in_theaters")!=-1?e.type="in_theaters":o.indexOf("coming_soon")!=-1?e.type="coming_soon":o.indexOf("top250")!=-1?e.type="top250":o.indexOf("america-movie")!=-1?e.type="america-movie":e.type=""}),e.search=""}]),angular.module("movieApp").controller("movieDetail",["$scope","$stateParams","jsonpServe","movieConfig",function(e,o,t,i){e.movieId=o.id,t.jsonp(i.moviede+e.movieId,{},function(o){e.movieDetail=o;for(var t=0;t<o.casts.length;t++)for(var i=0;i<o.directors.length;i++)o.casts[t].name==o.directors[i].name?e.isDirectors=!0:e.isDirectors=!1;console.log(e.isDirectors),e.$apply()})}]),angular.module("movieApp").controller("movieList",["$scope","jsonpServe","$stateParams","movieConfig",function(e,o,t,i){e.page=t.page,e.url=t.url,void 0!=t.q&&(e.url=e.url+"?q="+t.q),"top250"==e.url||e.url.indexOf("search")!=-1?e.year=!0:e.year=!1,e.pageLi=[],e.loading=!0,o.jsonp(i.jsonhttp+e.url,{start:(e.page-1)*i.movieli,count:i.movieli},function(o){e.loading=!1,e.movieList=o.subjects,e.movieListTitle=o.title,e.movieListTotal=o.total,e.pages=Math.ceil(e.movieListTotal/i.movieli),e.pageGroup=Math.ceil(e.pages/i.pagenum);for(var t=1;t<=e.pages;t++)e.pageLi.push(t);e.pageNums=Math.ceil(e.page/i.pagenum),e.pre=function(){e.pageNums>1&&e.pageNums--},e.next=function(){e.pageNums<Math.ceil(e.pages/i.pagenum)&&e.pageNums++},e.$apply()})}]);